<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>세종호랑이</title>
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Open Graph for KakaoTalk & Link Preview -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="세종호랑이 - 주식 & 일상">
    <meta property="og:description" content="미국/한국 주식 고수들의 포트폴리오 분석과 행복한 일상을 기록하는 공간입니다. 📈📸">
    <meta property="og:image" content="http://www.sjtiger.kr/thumbnail.png">
    <meta property="og:url" content="http://www.sjtiger.kr">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Top Header: Title & User Info -->
        <header class="dashboard-header glass-panel flat-header">
            <div class="header-left">
                <a href="stock.html" class="nav-link-btn"
                    style="text-decoration: none; color: white; background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 8px;">📈
                    주식정보</a>
                <a href="senior.html" class="nav-link-btn"
                    style="margin-left: 15px; text-decoration: none; color: white; background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 8px;">🧓
                    시니어생활</a>
                <a href="marketing.html" class="nav-link-btn"
                    style="margin-left: 15px; text-decoration: none; color: white; background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 8px;">📢
                    마케팅</a>
                <a href="senior_job.html" class="nav-link-btn"
                    style="margin-left: 15px; text-decoration: none; color: white; background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 8px;">💼
                    시니어취업</a>

            </div>
            <div class="header-right">
                <a href="https://link.coupang.com/a/bXSj4l" target="_blank" style="margin-right: 15px;">
                    <img src="coupang_logo.png" alt="쿠팡 홈으로 가기" style="height: 40px; border-radius: 8px;">
                </a>
                <div class="auth-separator"></div>
                <div class="auth-wrapper">
                    <span id="user-info"></span>
                    <button id="auth-btn">로그인</button>
                </div>
            </div>
        </header>

        <!-- Main Bento Grid -->
        <main class="bento-grid">
            <!-- Left Column: Daily Life -->
            <aside class="grid-column left-col">
                <!-- Ryeo-eun's Card -->
                <div id="ryeoeun-panel" class="bento-card glass-panel">
                    <div class="card-header">
                        <h3>행복한 일상 📸</h3>
                    </div>
                    <div id="ryeoeun-daily-content" class="daily-content-area">
                        <!-- Photo Block 1 -->
                        <div class="photo-block" style="margin-bottom: 25px;">
                            <img id="ryeoeun-display-img-1" src="ryeoeun_daily_life_1766300838840.png" alt="행복한 일상 사진 1"
                                class="daily-img">


                            <div class="admin-daily-editor" style="display: none; margin-top: 10px;">
                                <p class="editor-label">사진 1 변경</p>
                                <input type="file" id="ryeoeun-img-upload-1" accept="image/*" class="file-input">
                                <button id="ryeoeun-save-btn-1" class="save-daily-btn">사진 1 저장</button>
                            </div>
                        </div>

                        <hr class="divider" style="margin: 20px 0; opacity: 0.3;">

                        <!-- Photo Block 2 -->
                        <div class="photo-block">
                            <img id="ryeoeun-display-img-2" src="ryeoeun_daily_life_1766300838840.png" alt="행복한 일상 사진 2"
                                class="daily-img">


                            <div class="admin-daily-editor" style="display: none; margin-top: 10px;">
                                <p class="editor-label">사진 2 변경</p>
                                <input type="file" id="ryeoeun-img-upload-2" accept="image/*" class="file-input">
                                <button id="ryeoeun-save-btn-2" class="save-daily-btn">사진 2 저장</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lecture Card (C Grade Only) -->
                <div id="lecture-panel" class="bento-card glass-panel" style="margin-top: 25px;">
                    <div class="card-header">
                        <h3>특별 강의 🎬</h3>
                    </div>
                    <div class="video-container">
                        <iframe id="lecture-video" width="100%" height="315"
                            src="https://www.youtube.com/embed/coi0usPOiKU" title="YouTube video player" frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen style="border-radius:12px; border:1px solid var(--glass-border);">
                        </iframe>
                        <div id="video-lock-overlay" class="video-lock-overlay">
                            <p style="font-size:1.2rem; margin-bottom:10px;">🔒 <strong>C등급</strong> 전용</p>
                            <small>관리자에게 등급 상향을 요청하세요.</small>
                        </div>
                    </div>
                    <button id="open-video-popup-btn" class="secondary-btn"
                        style="width:100%; margin-top:10px; display:none;">📺 새 창에서 크게 보기</button>
                </div>
            </aside>

            <!-- Center Column: Hero & Focus -->
            <section class="grid-column center-col">
                <div class="hero-section">
                    <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
                        <h3 id="date" class="hero-date" style="margin: 0;"></h3>
                        <span id="weather" style="font-size: 1.2rem; color: var(--accent-color);"></span>
                    </div>

                    <h1 id="clock" class="clock-display">00:00:00</h1>
                    <h2 id="greeting" class="greeting-text">안녕하세요!</h2>
                </div>

                <div class="todo-section glass-panel bento-card">
                    <h3>오늘의 활동 및 목표 🎯</h3>
                    <div class="input-group">
                        <!-- Autofill Trap: Invisible inputs to trick browser -->
                        <div style="width:0; height:0; overflow:hidden; position:absolute;">
                            <input type="text" name="fake_username_trap" tabindex="-1">
                            <input type="password" name="fake_password_trap" tabindex="-1">
                        </div>

                        <input type="text" id="daily-goal-input" placeholder="새로운 목표 추가..." aria-label="할 일 입력"
                            autocomplete="new-password" name="unique_goal_field_v1" readonly
                            onfocus="this.removeAttribute('readonly');">

                        <div class="time-selector-group" style="display:flex; align-items:center; gap:5px;">
                            <select id="todo-hour" aria-label="시"></select> :
                            <select id="todo-minute" aria-label="분"></select>
                        </div>
                        <button id="add-btn">추가</button>
                    </div>
                    <ul id="todo-list" class="todo-list">
                        <!-- Todo items go here -->
                    </ul>
                </div>

                <!-- Ad Banner Container (Horizontal) -->
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <!-- Kyobo Ad Banner -->
                    <div class="ad-banner glass-panel bento-card"
                        style="flex: 1; padding: 0; overflow: hidden; border: none;">
                        <a href="https://lpweb.kr/click.php?m=kbbook&a=A100701605&l=0000" target="_blank"
                            style="display: block; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                            <img src="kyobo.png" alt="인터넷 교보문고" style="width: 70%; height: auto; display: block;">
                        </a>
                    </div>

                    <!-- YES24 Ad Banner -->
                    <div class="ad-banner glass-panel bento-card"
                        style="flex: 1; padding: 0; overflow: hidden; border: none;">
                        <a href="https://linkmoa.kr/click.php?m=yes24&a=A100701605&l=0000" target="_blank"
                            style="display: block; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                            <img src="yes24.png" alt="YES24" style="width: 70%; height: auto; display: block;">
                        </a>
                    </div>

                    <!-- USIMSA Ad Banner -->
                    <div class="ad-banner glass-panel bento-card"
                        style="flex: 1; padding: 0; overflow: hidden; border: none;">
                        <a href="https://linkmoa.kr/click.php?m=usimsa&a=A100701605&l=0000" target="_blank"
                            style="display: block; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                            <img src="usimsa.png" alt="USIMSA" style="width: 70%; height: auto; display: block;">
                        </a>
                    </div>

                    <!-- Yanolja Ad Banner -->
                    <div class="ad-banner glass-panel bento-card"
                        style="flex: 1; padding: 0; overflow: hidden; border: none;">
                        <a href="https://lase.kr/click.php?m=yanolja&a=A100701605&l=0000" target="_blank"
                            style="display: block; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                            <img src="yanolja.png" alt="Yanolja" style="width: 70%; height: auto; display: block;">
                        </a>
                    </div>
                </div>
            </section>

            <!-- Right Column: Community & Admin -->
            <aside class="grid-column right-col">
                <div class="request-section glass-panel bento-card">
                    <h3>소통의 창 💬</h3>
                    <p class="section-desc">자유롭게 의견을 남겨주세요</p>
                    <div class="request-input-group">
                        <textarea id="request-input" placeholder="메시지를 입력하세요..."></textarea>
                        <button id="send-request-btn">등록하기</button>
                    </div>
                    <div class="request-list-container"
                        style="margin-top: 10px; margin-bottom: 15px; height: 200px; overflow-y: auto;">
                        <ul id="request-list"></ul>
                    </div>
                    <button id="open-deposit-modal-btn" class="secondary-btn" style="width:100%; margin-bottom:15px;">💸
                        입금 확인 요청 (등급 UP)</button>

                    <div id="deposit-list-container"
                        style="margin-top: 10px; background: rgba(0,0,0,0.2); border-radius: 12px; padding: 10px; display: none;">
                        <h4 style="font-size: 0.9rem; color: var(--accent-secondary); margin-bottom: 8px;">💸 입금 요청 내역
                        </h4>
                        <ul id="deposit-list" style="list-style: none; padding: 0;"></ul>
                    </div>

                    <div style="text-align: center; margin-top: 15px; margin-bottom: 20px;">
                        <div id="visitor-count-display"
                            style="display: inline-block; padding: 8px 16px; background: rgba(255, 255, 255, 0.05); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                            방문자 : -명</div>
                    </div>

                    <div id="user-management-section" style="display: none;">
                        <hr class="divider">
                        <h3>회원 관리 🛡️</h3>
                        <div class="user-list-container">
                            <ul id="user-list"></ul>
                        </div>
                    </div>

                    <div style="margin-top: 20px; text-align: center;">
                        <!-- Legacy visitor count removed -->
                    </div>

                    <div id="admin-link-container" style="margin-top: 20px; display: none;">
                        <a href="admin_users.html" class="nav-link-btn"
                            style="display: block; text-align: center; background: rgba(255, 255, 255, 0.05); color: #cbd5e1; font-size: 0.9rem;">
                            🛡️ 회원 관리 시스템 (전체화면)
                        </a>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <footer class="partners-footer">
        이 포스팅은 쿠팡 파트너스 활동의 일환으로, 이에 따른 일정액의 수수료를 제공받습니다.
    </footer>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal-overlay">
        <div class="modal-content glass-panel">
            <div class="modal-header">
                <h3 id="modal-title">로그인</h3>
                <button id="close-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-tabs">
                <button id="tab-login" class="tab-btn active">로그인</button>
                <button id="tab-register" class="tab-btn">회원가입</button>
            </div>
            <div class="auth-form">
                <input type="email" id="auth-email" placeholder="이메일">
                <input type="text" id="auth-username" placeholder="이름 (닉네임)">
                <div class="password-input-wrapper" style="position: relative;">
                    <input type="password" id="auth-password" placeholder="비밀번호 (6자 이상)"
                        style="width: 100%; padding-right: 40px;">
                    <button id="toggle-password" type="button"
                        style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; font-size: 1.2rem; cursor: pointer; color: rgba(255,255,255,0.6);">
                        👁️
                    </button>
                </div>
                <button id="auth-submit-btn">로그인</button>
            </div>
        </div>
    </div>

    <!-- Deposit Request Modal -->
    <div id="deposit-modal" class="modal-overlay">
        <div class="modal-content glass-panel">
            <div class="modal-header">
                <h3>💸 입금 확인 요청</h3>
                <button id="close-deposit-modal" class="close-btn">&times;</button>
            </div>
            <div class="auth-form" style="display: flex; flex-direction: column; gap: 10px;">
                <input type="text" id="deposit-name" placeholder="입금자명 (예: 홍길동)"
                    style="height: 50px; box-sizing: border-box;">
                <select id="deposit-amount"
                    style="height: 50px; box-sizing: border-box; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white; padding: 0 10px;">
                    <option value="" disabled selected>입금 금액 선택</option>
                    <option value="10,000">1만원 (B등급 - 우수회원)</option>
                    <option value="100,000">10만원 (C등급 - VIP회원)</option>
                </select>
                <button id="deposit-submit-btn" style="height: 50px; margin-top: 0;" onclick="submitDepositRequest()">요청
                    보내기</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Inline Submission Logic for Index Page
        window.submitDepositRequest = function () {
            // Debugging alert to confirm function execution
            console.log("Submit function triggered");

            const depositNameInput = document.getElementById('deposit-name');
            const depositAmountInput = document.getElementById('deposit-amount');
            const depositModal = document.getElementById('deposit-modal');

            if (!depositNameInput || !depositAmountInput) {
                alert("오류: 입력창을 찾을 수 없습니다.");
                return;
            }

            const name = depositNameInput.value.trim();
            const amount = depositAmountInput.value.trim();

            if (!name || !amount) {
                alert('입금자명과 금액을 모두 입력해주세요.');
                return;
            }

            // Fallback for Firebase
            if (typeof firebase === 'undefined') {
                alert("Firebase 스크립트 로드 중입니다. 잠시 후 다시 시도해주세요.");
                return;
            }

            // Ensure Init
            if (!firebase.apps.length) {
                const firebaseConfig = {
                    apiKey: "AIzaSyAZhCOrlVWiTj-xuYprTciXlUbxnFeSE9E",
                    authDomain: "my-home-74cf5.firebaseapp.com",
                    projectId: "my-home-74cf5",
                    storageBucket: "my-home-74cf5.firebasestorage.app",
                    messagingSenderId: "7963220432",
                    appId: "1:7963220432:web:1541c1437b859e8023c1d5"
                };
                firebase.initializeApp(firebaseConfig);
            }

            const firestore = firebase.firestore();
            const user = firebase.auth().currentUser;
            const author = user ? user.displayName || user.email : '비회원/게스트';

            // Create formatted message
            const message = `[💸 입금 확인 요청]입금자: ${name} / 금액: ${amount}원`;
            const requestObj = {
                text: message,
                author: author,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            // Simply add the request without changing grade
            firestore.collection("guestRequests").add(requestObj)
                .then(() => {
                    alert('요청이 전송되었습니다! 관리자가 확인 후 등급을 변경해드립니다.');
                    if (depositModal) {
                        depositModal.style.display = 'none';
                        depositModal.classList.remove('active');
                    }
                    depositNameInput.value = '';
                    depositAmountInput.value = '';
                    // Force reload/redirect to ensure list update
                    window.location.href = 'index.html';
                })
                .catch((error) => {
                    console.error("Error adding document: ", error);
                    alert("전송 실패: " + error.message);
                });
        }
    </script>
    <div id="admin-link-container" onclick="location.href='admin_users.html'"
        style="position:fixed; bottom:60px; right:20px; z-index:9999; cursor:pointer; background:rgba(0, 0, 0, 0.6); color:#4CC9F0; padding:10px 20px; border-radius:30px; border:1px solid #4CC9F0; font-weight:bold; backdrop-filter:blur(5px); box-shadow: 0 4px 6px rgba(0,0,0,0.3); display:none;">
        ⚙️ 관리자 페이지</div>
    <div id="visitor-count" class="visitor-display-bottom"
        style="position:fixed; bottom:20px; right:20px; z-index:9999; display:flex; align-items:center; gap:8px;">
        <span onclick="restoreAdmin()" style="cursor:pointer; opacity:0.5;" title="관리자 권한 복구">🛠️</span>
    </div>
</body>

</html>